## 微信公众平台技术文档阅读笔记

### 常用名词   
1. AppID：开发者ID，配合开发者密码可调用公众号的接口能力。    
2. APPSecret：校验公众号开发者身份的密码。
3. OpenID：每一个公众号会产生一个OpenID    
4. UnionID：如果一个用户有多个公众号或移动应用，可将多个公众号和移动应用绑定到一个开放平台账号下，对于此开放平台账号下的所有公众号及移动应用，只有一个UnionID    
5. access_token: 接口调用凭据，有效期2小时，过期要重新获取，1天内获取次数有限。接口调用仅支持80端口。    
6. 微信JS-SDK：在网页上通过JavaScript代码使用微信原生功能的工具包。可以使用它在网页上录制和播放微信语音、监听微信分享、上传手机本地图片、拍照等许多能力。    
7. 获取用户基本信息：当需要通过网页的形式进行服务时，通过该接口，可以获取用户的基本信息（获取用户的OpenID是无需用户同意的，获取用户的基本信息则需用户同意）    

### 开始    
1. 获取access_token: 接口调用唯一凭证，有效期2小时，重新获取时将会导致上次获取的access_token失效，一天内获取次数有限，最好使用中控服务器同意获取和刷新，其他业务从中控服务器获取。   
2. 网络检测：排查回调失败原因，对对所有ip进行一次ping操作，得到丢包率和耗时    
3. 自定义菜单：自定义公众号底部的菜单，可以通过网页操作或者通过自定义菜单接口进行自定义    
4. 自定义菜单查询接口：使用该接口可获取所有默认菜单和自定义菜单    
5. 自定义菜单删除接口：使用该接口可删除当前使用的自定义菜单，会删除默认菜单及所有自定义菜单    
6. 自定义菜单推送: 用户点击菜单时，微信会把点击事件推送给开发者。有以下几种事件推送    
>> * 点击菜单拉取消息的事件推送   
>> * 点击菜单跳转链接的事件推送
>> * 扫码事件推送
>> * 扫码且弹出‘消息接收中’  弹框的事件推送
>> * 弹出系统拍照发图的事件推送
>> * 弹出拍照或者相册发图的事件推送
>> * 弹出微信相册发图的事件推送
>> * 弹出地理位置选择的事件推送    
7. 个性化菜单接口：针对不同的用户设置不同的菜单栏，可以通过一下条件设置用户看到的菜单    
    1. 用户标签    
    2. 性别    
    3. 手机操作系统    
    4. 地区（微信客户端设置的地区）    
    5. 语言（微信客户端设置的语言）
8. 获取自定义菜单配置接口：获取公众号当前使用的自定义菜单的配置
### 消息管理
1. 接收普通消息：当用户向公众号发送消息时，微信服务器将post消息的xml数据包到开发者填写的url上。消息包括：    
    1. 文本消息
    2. 图片消息
    3. 语音消息
    4. 视频消息
    5. 小视频消息
    6. 地理位置消息
    7. 链接消息
2. 接收事件推送：用户和公众号交互过程中会触发某些事件，微信服务器会将事件已通知的方式发送到开发者的服务器,使开发者可以获取到事件的信息。有以下几种事件：    
    1. 关注/取消关注事件
    2. 扫描带参数的二维码事件
    3. 地理位置事件
    4. 自定义菜单事件
    5. 点击菜单拉取消息事件
    6. 点击菜单跳转url事件
3. 被动回复用户消息：当公众号接收到用户发送的消息时,对该消息进行相应的回复。微信服务器在将用户的信息发送给开发者的服务器后，如果微信服务器在5秒内收不到响应会断掉连接，并重新发送请求，总共会重复三次。如果未得到回复或者开发者服务器回复了异常数据，则用户将会受到“该公众号暂时无法提供该服务，请稍后再试” 。如果开发者服务器无法在5秒内做出回应，则应该直接回复success或者回复空字符串，否则将会出现严重错误。    
4. 客服消息：当用户和公众号交互时，微信将把消息数据推送给开发者，开发者在一定时间内可以调用接口post一个json数据包给微信用户，主要用于客服等有人工处理的环节。
5. 群发和原创校验：订阅号可以每天进行一次群发，服务好每月4次。群发过程中，微信后台会自动进行图文消息的原创校验。

### 微信网页开发
1. 微信网页授权： 如果用户在微信客户端中访问第三方网页，公众号可以通过微信授权机制，来获取用户的基本信息，进而实现业务逻辑。
2. 微信JS-SDK：面向网页开发者提供的基于微信内的网页开发工具包。使用JS-SDK,开发者可借助微信使用拍照、语音、选图、位置等手机系统的能力,同时可以使用微信分享、扫一扫、卡券、支付等微信特有的能力。
>> * 微信js-sdk使用步骤
>> 1. 绑定域名: 在公众号设置——功能设置里填写“js接口安全域名”
>> 2. 引入js文件，[js文件地址](http://res.wx.qq.com/open/js/jweixin-1.4.0.js)
>> 3. 通过config接口注入权限验证配置    
```javascript
wx.config({
    debug: true, // 开启调试模式
    appId: '', // 必填
    timestamp: '', // 必填，生成签名的时间戳
    nonceStr: '', // 必填，生成签名的随机串
    signature: '', // 必填， 签名
    jsApiList: '' // 必填，需要使用的js接口列表
})

```
>> 4. 通过ready接口处理成功验证
```javascript
wx.ready(function() {/*       */})
```
>> 5. 通过error接口处理失败验证
```javascript
wx.error(function() {/*       */})            
```
### 素材管理
1. 新增临时素材：通过本接口，公众号可以上传临时素材。    
注意点：
>> 1. media_id可复用
>> 2. 临时素材有效期为3天
2. 获取临时素材：视频文件不支持https，使用时需要用http协议
3. 新增永久素材：常用素材可以通过该接口上传至微信服务器。新增素材也可以通过微信公众平台官网素材管理模块中进行管理。
4. 获取永久素材：可以根据media_id获取永久素材
5. 删除永久素材：通过本接口删除不在需要的永久素材。
6. 修改永久图文素材：通过本接口对永久接口进行修改。也可以在公众平台管理保存的图文消息。
7. 获取永久素材总数：通过本接口可以获取永久素材的列表，需要时也可以保存到本地
### 图文消息留言管理
 图文消息留言管理接口： 通过本接口可以管理公众号的留言功能，并可以指定可以评论的用户范围。
### 用户管理
1. 用户标签管理：通过该接口，可以对公众号的标签进行创建、查询、修改、删除等操作，也可以对用户进行打标签、取消标签等。1个公众号最多可以创建100个标签，可以为用户最多打上20个标签
2. 设置用户备注名：通过该接口对指定用户设置备注名，目前仅开放给微信认证的服务号。
3. 获取用户基本信息：通过openid获取用户基本信息。如果开发者拥有多个公众号或者移动应用，可以通过获取用户的unionid来区分用户的唯一性。同一个用户对于同一个微信开放平台下的不同应用，unionid是相同的。
4. 获取用户列表：通过本接口获取公众号得关注者列表，关注着列表由一串openid组成。
5. 获取用户地理位置：开通了上报用户地理位置接口的公众号，在用户进入公众号时会弹窗让用户确认是否允许获取用户地理位置。弹窗只在用户关注后出现一次。
6. 黑名单管理：公众号可对粉丝进行拉黑操作。可以获取黑名单列表，拉黑或者取消黑名单。

    
